<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Forum â€“ Beranda</title>
<style>
    body { font-family: Arial; padding: 20px; }
    .nav { display: flex; justify-content: space-between; margin-bottom: 20px; }
    button {
        padding: 10px 15px;
        border: none;
        background: black;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }
    .post {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #ddd;
        margin-bottom: 15px;
    }
</style>
</head>
<body>

<div class="nav">
    <h2>Mini Forum</h2>

    <div>
        <button onclick="goCreate()">Buat Post</button>
        <button onclick="login()" id="loginBtn">Login</button>
        <button onclick="logout()" id="logoutBtn" style="display:none;">Logout</button>
    </div>
</div>

<hr>

<h3>Daftar Postingan</h3>
<div id="post-list"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js"></script>

<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyD7TCMA0YL9m_D3umq7LBnSZ6_Ed5pzajg",
  authDomain: "mini-forum-9bee7.firebaseapp.com",
  projectId: "mini-forum-9bee7",
  storageBucket: "mini-forum-9bee7.firebasestorage.app",
  messagingSenderId: "650699848376",
  appId: "1:650699848376:web:ebf566678e297858de124d",
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// LOGIN SYSTEM
function login() {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}
function logout() {
    auth.signOut();
}

auth.onAuthStateChanged(user => {
    if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline";
    } else {
        loginBtn.style.display = "inline";
        logoutBtn.style.display = "none";
    }
});

// GO CREATE PAGE
function goCreate() {
    window.location.href = "create.html";
}

// LOAD POSTS
db.collection("posts")
  .orderBy("time", "desc")
  .onSnapshot(snapshot => {
    let html = "";
    snapshot.forEach(doc => {
        let p = doc.data();
        html += `
            <div class="post" onclick="openPost('${doc.id}')">
                <h3>${p.title}</h3>
                <p>${p.content.substring(0,100)}...</p>
                <small>${new Date(p.time).toLocaleString()}</small>
            </div>
        `;
    });

    document.getElementById("post-list").innerHTML = html;
});

function openPost(id) {
    window.location.href = "index.html?id=" + id;
}
</script>

</body>
</html>
